<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="full-screen" content="yes">
    <meta name="x5-fullscreen" content="true">
    <meta name="format-detection" content="telephone=no">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <title>Js与Java交互Demo</title>
    <script src="http://cdn.bootcss.com/zepto/1.2.0/zepto.min.js"></script>
</head>
<body>

<input type="button" id="enter0" value="测试弹窗" onclick="jsTestDialog();"/>

<br>

<input type="button" id="enter1" value="测试数据，带回调信息" onclick="jsDialogWithCallBack();"/>

<br>

<input type="button" id="enter2" value="预览PDF" onclick="jsDisplayPdf();"/>

<br>
<img id="imgTag"/>
<br>
<div id="div1" style="width:300px; height:200px;"></div>
<br>
<script>
    function addText(text){
        $("#div1").empty();

        var textNode = document.createElement("p");
        textNode.innerHTML = JSON.stringify(text);
        textNode.width = 340;
        textNode.height = 220;
        $("#div1").append(textNode);
    }

    function bridgeLog(logContent) {
        //do something
    }

    function jsTestDialog() {
        WebViewJavascriptBridge.callHandler('naviveDialog', "巴拉巴拉巴拉巴拉", function(res) {
            //do nothing
        });
    }

    function jsDialogWithCallBack() {
        WebViewJavascriptBridge.callHandler('naviveDialogWithCallBack', "是否要添加数据？？？", function(res) {
            alert(res);
            //console.log("回调结果==="+res);//res
            addText(res);
        });
    }

    function jsDisplayPdf() {
       window.WebViewJavascriptBridge.callHandler(
                'loadPdfFromWeb'
                ,{"pdfUrl":"http://rlrw.bnu.edu.cn/NewsImage/2012410100744.pdf","title":"Js异步编程"}
                , function(responseData) {
                    //do nothing
                }
            );
    }

    function config() {
        var iframe_ready = document.getElementById('iframe_ready');
        if (iframe_ready) return;
        var WVJBIframe = document.createElement('iframe');
        WVJBIframe.id = 'iframe_ready';
        WVJBIframe.style.display = 'none';
        WVJBIframe.src = 'jsbridge://__bridge_loaded__/';
        document.documentElement.appendChild(WVJBIframe);
    }

    function ready(callback) {
        if (window.WebViewJavascriptBridge) {
            callback()
        } else {
            document.addEventListener('WebViewJavascriptBridgeReady', function() {
                WebViewJavascriptBridge.init(function(message, responseCallback) {
                    var data = {
                        'Javascript Responds': '测试中文!'
                    };
                    if (typeof responseCallback != 'undefined') {
                        responseCallback(data);
                    }
                    return data;
                });
                callback();
            }, false);
        }
    }

    config();

    ready(function() {
        WebViewJavascriptBridge.registerHandler("methodFromJs", function(data, responseCallback) {
            //do something 给java调用的测试方法
            addText(data);
            var date = new Date();
            var seperator1 = "-";
            var seperator2 = ":";
            var month = date.getMonth() + 1;
            var strDate = date.getDate();
            if (month >= 1 && month <= 9) {
                month = "0" + month;
            }
            if (strDate >= 0 && strDate <= 9) {
                strDate = "0" + strDate;
            }
            var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
                + " " + date.getHours() + seperator2 + date.getMinutes()
                + seperator2 + date.getSeconds();
            return "当前时间:" + currentdate;
        });
    });

</script>
</body>
</html>